<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module aiutp_buffer</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module aiutp_buffer</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#types">Data Types</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>固定大小的环形缓冲区（链表实现）.

<p><b>Authors:</b> David Gao (<a href="mailto:david.alpha.fox@gmail.com"><code>david.alpha.fox@gmail.com</code></a>).</p>

<h2><a name="description">Description</a></h2><p>固定大小的环形缓冲区（链表实现）</p>
 
  <p>本模块实现了一个固定大小的缓冲区，用于存储 uTP 协议的发送/接收数据包。  
内部使用两个数组：一个存储数据，一个存储链表索引。</p>
 
  <h3><a name="数据结构">数据结构</a></h3>
  <pre>  +------------------+     +------------------+
  |   data array     |     |   index array    |
  +------------------+     +------------------+
  | 0: packet_a      |     | 0: 1 (next=1)    |
  | 1: packet_b      |     | 1: 2 (next=2)    |
  | 2: packet_c      |     | 2: -1 (end)      |
  | 3: undefined     |     | 3: 4 (free list) |
  | 4: undefined     |     | 4: -1 (end)      |
  +------------------+     +------------------+
 
  used (head) = 0  --&gt;  0 -&gt; 1 -&gt; 2 -&gt; -1 (已用链表)
  free        = 3  --&gt;  3 -&gt; 4 -&gt; -1      (空闲链表)
  tail        = 2                         (已用链表尾)</pre>
 
  <h3><a name="设计原理">设计原理</a></h3><p>  
- 使用链表而非环形索引，支持任意位置的插入和删除  
- 空闲槽位也形成链表，删除后的槽位可被重用  
- O(1) 的头部/尾部操作，O(n) 的中间插入/删除</p>
 
  <h3><a name="主要用途">主要用途</a></h3>
  - outbuf: 发送缓冲区，存储待发送和待确认的数据包
  - inbuf: 接收缓冲区，存储乱序到达的数据包（重排序缓冲区）
 
<h2><a name="types">Data Types</a></h2>

<h3 class="typedecl"><a name="type-aiutp_buffer">aiutp_buffer()</a></h3>
<p><b>abstract datatype</b>: <code>aiutp_buffer()</code></p>


<h3 class="typedecl"><a name="type-buffer_index">buffer_index()</a></h3>
<p><code>buffer_index() = -1 | non_neg_integer()</code></p>


<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#append-2">append/2</a></td><td>追加元素到缓冲区尾部.</td></tr>
<tr><td valign="top"><a href="#data-2">data/2</a></td><td>获取指定位置的数据.</td></tr>
<tr><td valign="top"><a href="#delete-3">delete/3</a></td><td>删除指定位置的元素.</td></tr>
<tr><td valign="top"><a href="#head-1">head/1</a></td><td>获取已用链表的头部索引.</td></tr>
<tr><td valign="top"><a href="#insert-3">insert/3</a></td><td>在指定位置后插入新元素.</td></tr>
<tr><td valign="top"><a href="#new-1">new/1</a></td><td>创建指定大小的新缓冲区.</td></tr>
<tr><td valign="top"><a href="#next-2">next/2</a></td><td>获取链表中的下一个索引.</td></tr>
<tr><td valign="top"><a href="#pop-1">pop/1</a></td><td>弹出头部元素.</td></tr>
<tr><td valign="top"><a href="#replace-3">replace/3</a></td><td>替换指定位置的数据.</td></tr>
<tr><td valign="top"><a href="#size-1">size/1</a></td><td>获取缓冲区总大小.</td></tr>
<tr><td valign="top"><a href="#tail-1">tail/1</a></td><td>获取已用链表的尾部索引.</td></tr>
<tr><td valign="top"><a href="#unused-1">unused/1</a></td><td>获取空闲槽位数.</td></tr>
<tr><td valign="top"><a href="#used-1">used/1</a></td><td>获取已用槽位数.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="append-2">append/2</a></h3>
<div class="spec">
<p><code>append(Val::term(), Buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; <a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a> | {error, buffer_overflow}</code><br></p>
<p><code>Val</code>: 要追加的值<br>
<code>Buffer</code>: 缓冲区<br>
</p>
<p>returns: 更新后的缓冲区，或 {error, buffer_overflow}</p>
</div><p><p>追加元素到缓冲区尾部</p>
 
  等价于 insert(tail(Buffer), Val, Buffer)。
 </p>

<h3 class="function"><a name="data-2">data/2</a></h3>
<div class="spec">
<p><code>data(Pos::non_neg_integer(), Aiutp_buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; term()</code><br></p>
<p><code>Pos</code>: 数据位置<br>
</p>
<p>returns: 该位置存储的数据</p>
</div><p>获取指定位置的数据
 </p>

<h3 class="function"><a name="delete-3">delete/3</a></h3>
<div class="spec">
<p><code>delete(Pos::non_neg_integer(), Prev::<a href="#type-buffer_index" docgen-rel="seetype" docgen-href="#buffer_index/0">buffer_index()</a>, Buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; <a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a></code><br></p>
<p><code>Pos</code>: 要删除的元素位置<br>
<code>Prev</code>: 被删除元素的前一个元素索引（-1 表示删除头部）<br>
<code>Buffer</code>: 缓冲区<br>
</p>
<p>returns: 更新后的缓冲区</p>
</div><p>删除指定位置的元素
 </p>

<h3 class="function"><a name="head-1">head/1</a></h3>
<div class="spec">
<p><code>head(Aiutp_buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; <a href="#type-buffer_index" docgen-rel="seetype" docgen-href="#buffer_index/0">buffer_index()</a></code><br></p>
<p> </p>
</div><p><p>获取已用链表的头部索引</p>
 
  返回 -1 表示缓冲区为空。</p>

<h3 class="function"><a name="insert-3">insert/3</a></h3>
<div class="spec">
<p><code>insert(Prev::<a href="#type-buffer_index" docgen-rel="seetype" docgen-href="#buffer_index/0">buffer_index()</a>, Val::term(), Buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; <a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a> | {error, buffer_overflow}</code><br></p>
<p><code>Prev</code>: 插入位置的前一个元素索引<br>
<code>Val</code>: 要插入的值<br>
<code>Buffer</code>: 缓冲区<br>
</p>
<p>returns: 更新后的缓冲区，或 {error, buffer_overflow}</p>
</div><p><p>在指定位置后插入新元素</p>
 
  - Prev = -1: 插入到链表头部
  - Prev = 其他: 插入到 Prev 之后
 </p>

<h3 class="function"><a name="new-1">new/1</a></h3>
<div class="spec">
<p><code>new(Size::pos_integer()) -&gt; <a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a></code><br></p>
<p><code>Size</code>: 缓冲区大小（必须为正整数）<br>
</p>
<p>returns: 新的空缓冲区</p>
</div><p><p>创建指定大小的新缓冲区</p>
 
  初始化数据数组和索引数组，所有槽位都在空闲链表中。
 </p>

<h3 class="function"><a name="next-2">next/2</a></h3>
<div class="spec">
<p><code>next(Pos::non_neg_integer(), Aiutp_buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; <a href="#type-buffer_index" docgen-rel="seetype" docgen-href="#buffer_index/0">buffer_index()</a></code><br></p>
<p><code>Pos</code>: 当前位置<br>
</p>
<p>returns: 下一个位置的索引，-1 表示链表结束</p>
</div><p>获取链表中的下一个索引
 </p>

<h3 class="function"><a name="pop-1">pop/1</a></h3>
<div class="spec">
<p><code>pop(Buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; <a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a></code><br></p>
<p><code>Buffer</code>: 缓冲区<br>
</p>
<p>returns: 更新后的缓冲区</p>
</div><p><p>弹出头部元素</p>
 
  等价于 delete(head(Buffer), -1, Buffer)。
 </p>

<h3 class="function"><a name="replace-3">replace/3</a></h3>
<div class="spec">
<p><code>replace(Pos::non_neg_integer(), Val::term(), Aiutp_buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; <a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a></code><br></p>
<p><code>Pos</code>: 要替换的位置<br>
<code>Val</code>: 新值<br>
</p>
<p>returns: 更新后的缓冲区</p>
</div><p><p>替换指定位置的数据</p>
 
  不改变链表结构，仅更新数据。
 </p>

<h3 class="function"><a name="size-1">size/1</a></h3>
<div class="spec">
<p><code>size(Aiutp_buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; non_neg_integer()</code><br></p>
<p> </p>
</div><p>获取缓冲区总大小</p>

<h3 class="function"><a name="tail-1">tail/1</a></h3>
<div class="spec">
<p><code>tail(Aiutp_buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; <a href="#type-buffer_index" docgen-rel="seetype" docgen-href="#buffer_index/0">buffer_index()</a></code><br></p>
<p> </p>
</div><p><p>获取已用链表的尾部索引</p>
 
  返回 -1 表示缓冲区为空。</p>

<h3 class="function"><a name="unused-1">unused/1</a></h3>
<div class="spec">
<p><code>unused(Aiutp_buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; non_neg_integer()</code><br></p>
<p> </p>
</div><p>获取空闲槽位数</p>

<h3 class="function"><a name="used-1">used/1</a></h3>
<div class="spec">
<p><code>used(Aiutp_buffer::<a href="#type-aiutp_buffer" docgen-rel="seetype" docgen-href="#aiutp_buffer/0">aiutp_buffer()</a>) -&gt; non_neg_integer()</code><br></p>
<p> </p>
</div><p>获取已用槽位数</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
