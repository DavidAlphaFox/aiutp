<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module aiutp_net</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module aiutp_net</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>uTP 网络 I/O 模块.
<p>Copyright © (C) 2020, David Gao</p>

<p><b>Authors:</b> David Gao (<a href="mailto:david.alpha.fox@gmail.com"><code>david.alpha.fox@gmail.com</code></a>).</p>

<h2><a name="description">Description</a></h2><p>uTP 网络 I/O 模块</p>
 
  <p>本模块负责所有网络相关操作，包括发送数据包、窗口管理和 ACK 调度。</p>
 
  <h3><a name="发送流程">发送流程</a></h3>
  <pre>  flush_queue/1 → send_queued_data/1 → send_new_packet/4 → do_send/2
  flush_packets/1 → send_packet/2 → do_send/2</pre>
 
  <h3><a name="窗口管理">窗口管理</a></h3><p>  
- window_size/2: 计算接收窗口大小  
- is_full/2: 检查发送窗口是否已满  
- max_send/1: 计算可发送的最大字节数</p>
 
  <h3><a name="发送模式">发送模式</a></h3><p>  
发送受拥塞窗口 (max_window) 和对端窗口 (max_window_user) 限制</p>
 
  <h3><a name="ACK_调度">ACK 调度</a></h3>
  - schedule_ack/1: 检查 ida 标志，如需要则发送 ACK
  - send_ack/1: 立即发送 ACK 包
  - send_keep_alive/1: 发送 keepalive 包
 
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#flush_packets-1">flush_packets/1</a></td><td>刷新待发送的数据包.</td></tr>
<tr><td valign="top"><a href="#flush_queue-1">flush_queue/1</a></td><td>刷新发送队列.</td></tr>
<tr><td valign="top"><a href="#is_full-2">is_full/2</a></td><td>检查发送窗口是否已满.</td></tr>
<tr><td valign="top"><a href="#schedule_ack-1">schedule_ack/1</a></td><td>调度 ACK 发送.</td></tr>
<tr><td valign="top"><a href="#send_ack-1">send_ack/1</a></td><td>发送 ACK 包.</td></tr>
<tr><td valign="top"><a href="#send_fin-1">send_fin/1</a></td><td>发送 FIN 包.</td></tr>
<tr><td valign="top"><a href="#send_keep_alive-1">send_keep_alive/1</a></td><td>发送 Keepalive 包.</td></tr>
<tr><td valign="top"><a href="#send_n_packets-4">send_n_packets/4</a></td><td>发送指定序列号范围内的 N 个数据包.</td></tr>
<tr><td valign="top"><a href="#send_packet-2">send_packet/2</a></td><td>发送指定位置的数据包.</td></tr>
<tr><td valign="top"><a href="#send_reset-1">send_reset/1</a></td><td>发送 RESET 包.</td></tr>
<tr><td valign="top"><a href="#send_skipped_packets-5">send_skipped_packets/5</a></td><td>发送被 SACK 跳过的数据包（精确快速重传）.</td></tr>
<tr><td valign="top"><a href="#window_size-2">window_size/2</a></td><td>计算接收窗口大小（字节）.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="flush_packets-1">flush_packets/1</a></h3>
<div class="spec">
<p><code>flush_packets(Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}</code><br></p>
<p> </p>
<p>returns: 更新后的 PCB</p>
</div><p><p>刷新待发送的数据包</p>
 
  遍历 outbuf，发送所有需要发送的包（新包或标记为重发的包）。
 </p>

<h3 class="function"><a name="flush_queue-1">flush_queue/1</a></h3>
<div class="spec">
<p><code>flush_queue(Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}</code><br></p>
<p> </p>
<p>returns: 更新后的 PCB</p>
</div><p><p>刷新发送队列</p>
 
  将 outque 中的数据打包发送。如果窗口允许，尽可能多地发送。
 </p>

<h3 class="function"><a name="is_full-2">is_full/2</a></h3>
<div class="spec">
<p><code>is_full(Bytes::integer(), Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; {boolean(), #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}}</code><br></p>
<p><code>Bytes</code>: 要发送的字节数（-1 表示使用 PACKET_SIZE）<br>
</p>
<p>returns: {IsFull, UpdatedPCB}</p>
</div><p><p>检查发送窗口是否已满</p>
 
  检查 cur_window + Bytes 是否超过窗口限制
 </p>

<h3 class="function"><a name="schedule_ack-1">schedule_ack/1</a></h3>
<div class="spec">
<p><code>schedule_ack(Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}</code><br></p>
<p> </p>
<p>returns: 更新后的 PCB</p>
</div><p><p>调度 ACK 发送</p>
 
  如果 ida (immediate delayed ack) 标志为 true，立即发送 ACK。
 </p>

<h3 class="function"><a name="send_ack-1">send_ack/1</a></h3>
<div class="spec">
<p><code>send_ack(Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}</code><br></p>
<p> </p>
<p>returns: 更新后的 PCB</p>
</div><p><p>发送 ACK 包</p>
 
  如果有乱序包（reorder_count &gt; 0），附带 SACK 扩展。
 </p>

<h3 class="function"><a name="send_fin-1">send_fin/1</a></h3>
<div class="spec">
<p><code>send_fin(Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}</code><br></p>
<p> </p>
<p>returns: 更新后的 PCB</p>
</div><p><p>发送 FIN 包</p>
 
  将 FIN 放入发送队列并刷新。
 </p>

<h3 class="function"><a name="send_keep_alive-1">send_keep_alive/1</a></h3>
<div class="spec">
<p><code>send_keep_alive(Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}</code><br></p>
<p> </p>
<p>returns: 更新后的 PCB</p>
</div><p><p>发送 Keepalive 包</p>
 
  通过发送一个带有错误 ack_nr 的 ACK 来实现，对端会响应一个新的 ACK。
 </p>

<h3 class="function"><a name="send_n_packets-4">send_n_packets/4</a></h3>
<div class="spec">
<p><code>send_n_packets(MinSeq::non_neg_integer(), MaxSeq::non_neg_integer(), Limit::non_neg_integer(), Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; {non_neg_integer(), non_neg_integer(), #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}}</code><br></p>
<p><code>MinSeq</code>: 最小序列号<br>
<code>MaxSeq</code>: 最大序列号<br>
<code>Limit</code>: 最多发送的包数<br>
</p>
<p>returns: {SentCount, LastSeqNR, UpdatedPCB}</p>
</div><p>发送指定序列号范围内的 N 个数据包
 </p>

<h3 class="function"><a name="send_packet-2">send_packet/2</a></h3>
<div class="spec">
<p><code>send_packet(Pos::integer(), Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}</code><br></p>
<p><code>Pos</code>: outbuf 中的位置（-1 表示无效）<br>
</p>
<p>returns: 更新后的 PCB</p>
</div><p>发送指定位置的数据包
 </p>

<h3 class="function"><a name="send_reset-1">send_reset/1</a></h3>
<div class="spec">
<p><code>send_reset(Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}</code><br></p>
<p> </p>
<p>returns: 更新后的 PCB</p>
</div><p><p>发送 RESET 包</p>
 
  BEP-29：RESET 包用于通知对端连接终止，允许对端立即清理状态。
 </p>

<h3 class="function"><a name="send_skipped_packets-5">send_skipped_packets/5</a></h3>
<div class="spec">
<p><code>send_skipped_packets(MinSeq::non_neg_integer(), MaxSeq::non_neg_integer(), SAckedSeqs::<a href="/home/david/workspace/stdlib/doc/sets.html#type-set" docgen-rel="seetype" docgen-href="stdlib:sets#set/0">sets:set()</a>, Limit::non_neg_integer(), Aiutp_pcb::#aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}) -&gt; {non_neg_integer(), non_neg_integer(), #aiutp_pcb{conn_id_recv = non_neg_integer() | undefined, conn_id_send = non_neg_integer() | undefined, socket = {<a href="/home/david/workspace/kernel/doc/gen_udp.html#type-socket" docgen-rel="seetype" docgen-href="kernel:gen_udp#socket/0">gen_udp:socket()</a>, {<a href="/home/david/workspace/kernel/doc/inet.html#type-ip_address" docgen-rel="seetype" docgen-href="kernel:inet#ip_address/0">inet:ip_address()</a>, <a href="/home/david/workspace/kernel/doc/inet.html#type-port_number" docgen-rel="seetype" docgen-href="kernel:inet#port_number/0">inet:port_number()</a>}} | undefined, state = atom(), close_requested = boolean(), seq_nr = non_neg_integer(), ack_nr = non_neg_integer(), fast_resend_seq_nr = non_neg_integer(), got_fin = boolean(), got_fin_reached = boolean(), fin_sent = boolean(), fin_sent_acked = boolean(), eof_pkt = non_neg_integer(), cur_window = non_neg_integer(), cur_window_packets = non_neg_integer(), max_window = non_neg_integer(), max_window_user = non_neg_integer(), last_rcv_win = non_neg_integer(), last_rwin_decay = non_neg_integer(), rtt = non_neg_integer(), rtt_var = non_neg_integer(), rto = non_neg_integer(), rtt_hist = any(), retransmit_timeout = non_neg_integer(), rto_timeout = non_neg_integer(), target_delay = non_neg_integer(), ssthresh = non_neg_integer(), slow_start = boolean(), last_maxed_out_window = non_neg_integer(), our_hist = any(), their_hist = any(), average_delay = integer(), current_delay_sum = integer(), current_delay_samples = non_neg_integer(), average_delay_base = non_neg_integer(), average_sample_time = non_neg_integer(), last_measured_delay = non_neg_integer(), clock_drift = integer(), retransmit_count = non_neg_integer(), duplicate_ack = non_neg_integer(), fast_timeout = boolean(), reorder_count = non_neg_integer(), time = non_neg_integer() | undefined, recv_time = non_neg_integer() | undefined, last_got_packet = non_neg_integer(), last_sent_packet = non_neg_integer(), reply_micro = non_neg_integer(), zerowindow_time = non_neg_integer(), inbuf = any(), outbuf = any(), inque = any(), outque = any(), ida = boolean(), mtu_floor = non_neg_integer(), mtu_ceiling = non_neg_integer(), mtu_last = non_neg_integer(), mtu_probe_seq = non_neg_integer(), mtu_probe_size = non_neg_integer(), mtu_discover_time = non_neg_integer(), mtu_probe_failures = non_neg_integer()}}</code><br></p>
<p><code>MinSeq</code>: 最小序列号<br>
<code>MaxSeq</code>: 最大序列号<br>
<code>SAckedSeqs</code>: SACK 确认的序列号集合<br>
<code>Limit</code>: 最多发送的包数<br>
</p>
<p>returns: {SentCount, LastSeqNR, UpdatedPCB}</p>
</div><p><p>发送被 SACK 跳过的数据包（精确快速重传）</p>
 
  libutp 风格：只重传在指定范围内且未被 SACK 确认的包。
  这比 send_n_packets 更精确，避免重传已被 SACK 确认的包。
 </p>

<h3 class="function"><a name="window_size-2">window_size/2</a></h3>
<div class="spec">
<p><code>window_size(MaxWindow::integer(), InBuf::<a href="/home/david/workspace/aiutp/doc/aiutp_buffer.html#type-aiutp_buffer" docgen-rel="seetype" docgen-href="aiutp:aiutp_buffer#aiutp_buffer/0">aiutp_buffer:aiutp_buffer()</a>) -&gt; non_neg_integer()</code><br></p>
<p><code>MaxWindow</code>: 最大窗口大小（未使用）<br>
<code>InBuf</code>: 接收缓冲区<br>
</p>
<p>returns: 接收窗口大小（字节）</p>
</div><p><p>计算接收窗口大小（字节）</p>
 
  接收窗口 = 未使用的缓冲区槽位 * 包大小
 </p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
