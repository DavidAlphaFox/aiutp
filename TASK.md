# AIUTP ä»»åŠ¡è¿½è¸ª

> æœ€åæ›´æ–°: 2025-12-03

## å½“å‰ä»»åŠ¡

### è¿›è¡Œä¸­

| ä»»åŠ¡ | æè¿° | å¼€å§‹æ—¥æœŸ | çŠ¶æ€ |
|------|------|----------|------|
| (æ— ) | - | - | - |

### å¾…å¤„ç†

| ä»»åŠ¡ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| å±æ€§æµ‹è¯• | ä½¿ç”¨ PropEr æ·»åŠ å±æ€§æµ‹è¯• | ä¸­ |
| API æ–‡æ¡£ | æ·»åŠ  edoc æ ¼å¼çš„ API æ–‡æ¡£ | ä¸­ |
| æ€§èƒ½æµ‹è¯• | å»ºç«‹æ€§èƒ½åŸºå‡†æµ‹è¯• | ä½ |
| Hex å‘å¸ƒ | å‡†å¤‡å‘å¸ƒåˆ° Hex.pm | ä½ |

## å·²å®Œæˆä»»åŠ¡

### 2025-12-03
- [x] é¡¹ç›®åˆå§‹åŒ–
- [x] åˆ›å»º PLANNING.md è§„åˆ’æ–‡æ¡£
- [x] åˆ›å»º TASK.md ä»»åŠ¡è¿½è¸ª
- [x] åˆ›å»ºæ–‡æ¡£ç›®å½•ç»“æ„
- [x] å®Œæˆå…¨é¢ä»£ç åˆ†ææŠ¥å‘Š
- [x] ä¸ºæ ¸å¿ƒçº¯å‡½æ•°æ¨¡å—æ·»åŠ  EUnit æµ‹è¯• (100 ä¸ªæµ‹è¯•ç”¨ä¾‹)
  - aiutp_util: 100% è¦†ç›–ç‡
  - aiutp_queue: 100% è¦†ç›–ç‡
  - aiutp_delay: 100% è¦†ç›–ç‡
  - aiutp_packet: 97% è¦†ç›–ç‡
  - aiutp_buffer: 96% è¦†ç›–ç‡
- [x] BEP-29 åè®®åˆ†ææŠ¥å‘Š (docs/report/bep29-analysis-2025-12-03.md)
  - ä¸¢åŒ…é‡ä¼ æœºåˆ¶åˆ†æ
  - å¯¹ç«¯å´©æºƒå¤„ç†åˆ†æ
  - æ–­å¼€è¿æ¥å¤„ç†åˆ†æ
  - é¡¹ç›®å®ç°ä¸æ ‡å‡†å·®å¼‚å¯¹æ¯”
- [x] PCB å’Œå¸¸é‡é‡æ„ (include/aiutp.hrl)
  - å¸¸é‡æŒ‰ BEP-29 æ ‡å‡†åˆ†ç»„ï¼ˆ13 ä¸ª Sectionï¼‰
  - æ·»åŠ åè®®ç‰ˆæœ¬ã€æ‰©å±•ç±»å‹ã€è¶…æ—¶å‚æ•°ç­‰æ–°å¸¸é‡
  - PCB è®°å½•æŒ‰åŠŸèƒ½åˆ†ç»„ï¼ˆè¿æ¥æ ‡è¯†ã€çŠ¶æ€ã€åºåˆ—å·ã€FINå¤„ç†ã€çª—å£ã€RTT/RTOã€æ‹¥å¡æ§åˆ¶ã€å»¶è¿Ÿç»Ÿè®¡ã€é‡ä¼ ã€æ—¶é—´æˆ³ã€ç¼“å†²åŒºã€ç‰¹æ®Šæ¨¡å¼ï¼‰
  - ä¿®å¤æ‹¼å†™é”™è¯¯ï¼š`brust` -> `burst`, `fasle` -> `false`
  - æ·»åŠ è¯¦ç»†çš„å­—æ®µæ³¨é‡Šå’Œç±»å‹è§„èŒƒ
- [x] é«˜ä¼˜å…ˆçº§æŠ€æœ¯å€ºåŠ¡ä¿®å¤
  - ä¿®å¤ aiutp_sup.erl supervisor å­è¿›ç¨‹ ID æ‹¼å†™é”™è¯¯
  - ä¿®å¤ aiutp_worker.erl ä¸å­˜åœ¨çš„å‡½æ•°è°ƒç”¨ (remove_conn -> free_conn)
  - ä¿®å¤ aiutp_worker.erl æ‹¼å†™é”™è¯¯ (undefiend -> undefined)
  - æ”¹è¿› aiutp_socket.erl æ•°æ®åŒ…è§£ç é”™è¯¯æ—¥å¿— (ä½¿ç”¨ logger:debug)
  - æ”¹è¿› aiutp_net.erl UDP å‘é€é”™è¯¯å¤„ç† (ä¸å†å´©æºƒè¿›ç¨‹)
  - æ·»åŠ  aiutp_sup_tests å’Œ aiutp_net_tests å•å…ƒæµ‹è¯• (109 ä¸ªæµ‹è¯•ç”¨ä¾‹)
- [x] æ–‡æ¡£å®Œå–„ (v0.1.0 é‡Œç¨‹ç¢‘å®Œæˆ)
  - å¢å¼º README.mdï¼šæ·»åŠ å¾½ç« ã€è¯¦ç»† API æ–‡æ¡£
  - æ·»åŠ æœåŠ¡ç«¯/å®¢æˆ·ç«¯/Active æ¨¡å¼ä½¿ç”¨ç¤ºä¾‹
  - æ·»åŠ å®‰è£…å’Œå¿«é€Ÿå¼€å§‹æŒ‡å—
  - æ·»åŠ åè®®å‚æ•°è¯´æ˜è¡¨æ ¼
  - æ·»åŠ æ¶æ„æ¦‚è§ˆå’Œæ¨¡å—èŒè´£è¯´æ˜
  - æ·»åŠ å¼€å‘æŒ‡å—ï¼ˆæ„å»ºã€æµ‹è¯•ã€ç±»å‹æ£€æŸ¥ï¼‰
- [x] Worker é‡æ„ä¸º Channel (gen_statem)
  - åˆ›å»º aiutp_channel.erl ä½¿ç”¨ gen_statem è¡Œä¸º
  - å®ç° 5 ä¸ªçŠ¶æ€ï¼šidle, connecting, accepting, connected, closing
  - åˆ›å»º aiutp_channel_sup.erl ç›‘ç£å™¨
  - é›†æˆåˆ° aiutp_sup ç›‘ç£æ ‘
  - æ›´æ–° aiutp_socket.erl ä½¿ç”¨ channel
  - æ›´æ–° aiutp_acceptor.erl ä½¿ç”¨ channel
  - æ›´æ–° aiutp.erl API ä½¿ç”¨ channel
  - æ·»åŠ  aiutp_channel_tests.erl å•å…ƒæµ‹è¯• (6 ä¸ªæµ‹è¯•ç”¨ä¾‹)
  - åˆ é™¤æ—§æ¨¡å—ï¼šaiutp_worker.erl, aiutp_worker_sup.erl
  - æ€»è®¡ 115 ä¸ªæµ‹è¯•ç”¨ä¾‹é€šè¿‡
- [x] ä»£ç è´¨é‡ä¿®å¤
  - æ›¿æ¢ aiutp_pcb.erl ä¸­çš„ io:format ä¸º logger:warning (3 å¤„)
  - æ”¹è¿› aiutp_sup.erl ç›‘ç£ç­–ç•¥ (one_for_all â†’ rest_for_one)
  - ä¸º aiutp_util.erl ä¸­çš„ wrapping_compare_less æ·»åŠ æ–‡æ¡£å’Œç±»å‹è§„èŒƒ
  - æ›´æ–°ç›¸å…³æµ‹è¯•ç”¨ä¾‹
  - æ€»è®¡ 115 ä¸ªæµ‹è¯•ç”¨ä¾‹é€šè¿‡
- [x] aiutp_pcb.erl æ¨¡å—æ‹†åˆ†é‡æ„
  - åˆ›å»º aiutp_pcb_cc.erl æ‹¥å¡æ§åˆ¶æ¨¡å— (LEDBAT ç®—æ³•)
    - cc_control/4: ä¸»æ‹¥å¡æ§åˆ¶é€»è¾‘
    - maybe_decay_win/1: çª—å£è¡°å‡
    - ack_packet/3: ACK åŒ… RTT å¤„ç†
    - caculate_acked_bytes/4: è®¡ç®—å·²ç¡®è®¤å­—èŠ‚æ•°
    - selective_ack_packet/3: SACK å¤„ç†
  - åˆ›å»º aiutp_pcb_timeout.erl è¶…æ—¶å¤„ç†æ¨¡å—
    - check_timeouts/1: è¶…æ—¶æ£€æŸ¥å…¥å£
    - mark_need_resend/4: æ ‡è®°é‡ä¼ åŒ…
  - é‡æ„ aiutp_pcb.erl (669è¡Œ â†’ 585è¡Œ)
    - æ·»åŠ è¯¦ç»†çš„ edoc æ–‡æ¡£
    - æ”¹è¿›å‡½æ•°å‘½å (process â†’ process_by_type)
    - æ¸…ç†æ³¨é‡Šå’Œæ ¼å¼
  - æ·»åŠ æ–°æ¨¡å—æµ‹è¯• (20 ä¸ªæµ‹è¯•ç”¨ä¾‹)
    - aiutp_pcb_cc_tests.erl (11 ä¸ªæµ‹è¯•)
    - aiutp_pcb_timeout_tests.erl (9 ä¸ªæµ‹è¯•)
  - æ€»è®¡ 135 ä¸ªæµ‹è¯•ç”¨ä¾‹é€šè¿‡

### å†å²ä»»åŠ¡
- [x] å®ç° uTP åè®®æ ¸å¿ƒé€»è¾‘ (aiutp_pcb)
- [x] å®ç°æ•°æ®åŒ…ç¼–è§£ç  (aiutp_packet)
- [x] å®ç° OTP supervisor æ ‘ç»“æ„
- [x] å®ç°åŸºæœ¬çš„è¿æ¥ç®¡ç† (aiutp_socket, aiutp_channel)
- [x] å®ç° LEDBAT æ‹¥å¡æ§åˆ¶
- [x] å®ç°é€‰æ‹©æ€§ç¡®è®¤ (SACK)
- [x] æ·»åŠ  Micro Transport Protocol æ³¨é‡Š

## å‘ç°çš„å·¥ä½œ

> åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‘ç°çš„æ–°ä»»åŠ¡æˆ–éœ€è¦æ³¨æ„çš„äº‹é¡¹

### æŠ€æœ¯å€ºåŠ¡ï¼ˆé«˜ä¼˜å…ˆçº§ - ç«‹å³ä¿®å¤ï¼‰
- [x] ~~**aiutp_worker.erl:329** - ğŸ”´ ä¸¥é‡ï¼šè°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•° `aiutp_socket:remove_conn/2`ï¼Œåº”æ”¹ä¸º `free_conn/3`~~ (å·²ä¿®å¤)
- [x] ~~**aiutp.hrl:89** - ğŸ”´ æ‹¼å†™é”™è¯¯: `ida = fasle` åº”ä¸º `ida = false`~~ (å·²åœ¨ PCB é‡æ„ä¸­ä¿®å¤)
- [x] ~~**aiutp_pcb.erl:505** - ğŸ”´ æ‹¼å†™é”™è¯¯: `{fasle,PCB#...` åº”ä¸º `{false,PCB#...`~~ (å·²ä¿®å¤)
- [x] ~~**aiutp_worker.erl:193** - ğŸ”´ æ‹¼å†™é”™è¯¯: `undefiend` åº”ä¸º `undefined`~~ (å·²ä¿®å¤)
- [x] ~~**aiutp_worker.erl:314** - ğŸ”´ æ‹¼å†™é”™è¯¯: `undefiend` åº”ä¸º `undefined`~~ (å·²ä¿®å¤)
- [x] ~~**aiutp_sup.erl:22** - ğŸ”´ æ‹¼å†™é”™è¯¯: `aiutp_woker_sup` åº”ä¸º `aiutp_worker_sup`~~ (å·²ä¿®å¤)
- [x] ~~**aiutp_socket.erl:168-169** - âš ï¸ æ•°æ®åŒ…è§£ç å¤±è´¥æ—¶é™é»˜ä¸¢å¼ƒï¼Œéœ€æ·»åŠ æ—¥å¿—~~ (å·²æ·»åŠ  logger:debug)
- [x] ~~**aiutp_net.erl:349** - âš ï¸ UDP å‘é€å¤±è´¥æ—¶ç›´æ¥å´©æºƒè¿›ç¨‹ï¼Œåº”ä¼˜é›…å¤„ç†~~ (å·²æ”¹ä¸ºè¿”å›é”™è¯¯å¹¶è®°å½•æ—¥å¿—)

### æµ‹è¯•ç›¸å…³
- [x] æ·»åŠ  EUnit å•å…ƒæµ‹è¯•å¥—ä»¶ (115 ä¸ªæµ‹è¯•ç”¨ä¾‹)
- [ ] æ·»åŠ  Common Test é›†æˆæµ‹è¯•
- [ ] æ·»åŠ  PropEr å±æ€§æµ‹è¯•
- [ ] ä¸º gen_server/gen_statem æ¨¡å—æ·»åŠ æµ‹è¯• (aiutp_socket, aiutp_channel)
- [ ] ä¸º aiutp_rtt:caculate_delay/4 æ·»åŠ æµ‹è¯• (éœ€è¦ PCB è®°å½•)
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°æ ¸å¿ƒåŠŸèƒ½ 100%

### æ¶æ„æ”¹è¿›
- [x] `aiutp_pcb.erl` - æ¨¡å—æ‹†åˆ†å®Œæˆ (669è¡Œ â†’ 585è¡Œ + 2ä¸ªå­æ¨¡å—)
  - aiutp_pcb_cc.erl: æ‹¥å¡æ§åˆ¶ (~200è¡Œ)
  - aiutp_pcb_timeout.erl: è¶…æ—¶å¤„ç† (~180è¡Œ)
- [x] `aiutp_channel.erl` - gen_statem çŠ¶æ€æœºå®ç°å®Œæˆ
- [x] ä½¿ç”¨ logger æ¨¡å—æ›¿ä»£ io:format (aiutp_pcb.erl, aiutp_socket.erl)
- [x] æ”¹è¿›ç›‘ç£ç­–ç•¥ (one_for_all â†’ rest_for_one)
- [ ] æ·»åŠ ç»“æ„åŒ–æ—¥å¿—å’Œç›‘æ§æŒ‡æ ‡
- [ ] é…ç½®ç®¡ç†æ”¹ç”¨åº”ç”¨ç¯å¢ƒå˜é‡

### æ”¹è¿›å»ºè®®
- [ ] æ·»åŠ  dialyzer ç±»å‹è§„èŒƒæ£€æŸ¥
- [ ] è€ƒè™‘ä½¿ç”¨ maps æ›¿ä»£éƒ¨åˆ† recordï¼Œæé«˜å¯è¯»æ€§
- [ ] è€ƒè™‘æ”¯æŒ IPv6

## é‡Œç¨‹ç¢‘

### v0.1.0 (å·²å®Œæˆ âœ…)
- [x] åŸºæœ¬åè®®å®ç°
- [x] OTP ç»“æ„
- [x] åŸºç¡€æµ‹è¯• (109 ä¸ªæµ‹è¯•ç”¨ä¾‹)
- [x] æ–‡æ¡£å®Œå–„ (README.md å¢å¼º)

### v0.2.0 (è¿›è¡Œä¸­)
- [x] gen_statem é‡æ„ (aiutp_channel)
- [ ] å®Œæ•´æµ‹è¯•è¦†ç›– (å½“å‰ 115 ä¸ªæµ‹è¯•)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] API ç¨³å®šåŒ–

### v1.0.0 (ç›®æ ‡)
- [ ] ç”Ÿäº§å°±ç»ª
- [ ] Hex.pm å‘å¸ƒ
- [ ] å®Œæ•´æ–‡æ¡£
- [ ] ç¤ºä¾‹åº”ç”¨

---

## ä»»åŠ¡å½’æ¡£è¯´æ˜

å®Œæˆçš„ä»»åŠ¡å°†å®šæœŸå½’æ¡£åˆ° `docs/tasks/` ç›®å½•ï¼ŒæŒ‰æ—¥æœŸå‘½åã€‚ä¾‹å¦‚:
- `docs/tasks/2025-12-03.md`
